import e,{useState as r,useContext as t}from"react";import{useHistory as o}from"react-router-dom";import{useEffectOnce as n}from"react-use";"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var i=e.createContext({}),u=function(t){var u=t.children,c=t.forbiddenPath;void 0===c&&(c="/forbidden");var s=t.loadingComponent;void 0===s&&(s=function(){return e.createElement("div",null,"Loading")});var a=t.client;void 0===a&&(a={login:function(e){return Promise.resolve()},register:function(e){return Promise.resolve()},getUserInfo:function(){return Promise.resolve({id:1,name:"Mock"})},logout:function(){return Promise.resolve()}});var l=r(),f=l[0],m=l[1],v=r(!0),d=v[0],h=v[1],y=o();if(n(function(){try{function e(){h(!1)}var r=function(e,r){try{var t=Promise.resolve(a.getUserInfo()).then(function(e){m(e)})}catch(e){return r()}return t&&t.then?t.then(void 0,r):t}(0,function(){console.log("Not authenticated")});return Promise.resolve(r&&r.then?r.then(e):e())}catch(e){return Promise.reject(e)}}),d)return s();var b=function(){try{return Promise.resolve(a.getUserInfo()).then(function(e){return m(e),e})}catch(e){return Promise.reject(e)}},P=Object.assign({},{user:f,onForbidden:function(){return y.push(c)}},a,{getUserInfo:b,login:function(e){try{return Promise.resolve(a.login(e)).then(function(){return Promise.resolve(b())})}catch(e){return Promise.reject(e)}},logout:function(){try{return Promise.resolve(a.logout()).then(function(){m(null)})}catch(e){return Promise.reject(e)}}});return e.createElement(i.Provider,{value:P},u)},c=function(){var e=t(i);if(!e)throw new Error("useAuth should be use in side auth context");return e},s=function(e){var r=c(),t=r.onForbidden;r.user||(e?e():t())};export{u as AuthProvider,c as useAuth,s as useAuthenticated};
//# sourceMappingURL=index.mjs.map
